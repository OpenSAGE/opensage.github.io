<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/styles.9d31b7140cefbb100646.css">@import url(https://fonts.googleapis.com/css?family=Noto+Serif+TC|Source+Code+Pro);
/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}main{display:block}h1{font-size:2em;margin:.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:.35em .75em .625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}[hidden],template{display:none}*{box-sizing:border-box}body,html{margin:0;padding:0;min-height:100%;display:flex;width:100%}body{font-family:"Noto Serif TC",serif;font-size:16px;line-height:1.6}h1,h2{margin-top:1em}h2{margin-bottom:.5em}h1+h2,h2+ul{margin-top:0}#___gatsby,#___gatsby>div{display:flex;height:100%;width:100%}.page{max-width:100%}#main-content,.page{display:flex;flex-direction:column;flex-grow:1;width:100%}#main-content{flex-shrink:0;padding-left:2em;padding-right:2em;margin-left:auto;margin-right:auto;margin-bottom:40px;max-width:700px}.row{display:flex;flex-direction:row;flex-shrink:0}.row+.row{margin-top:16px}.width-50{max-width:50%;flex-shrink:0}.responsive-image{display:flex;flex-shrink:1;max-width:100%}.responsive-image+.responsive-image,.responsive-image-container+.responsive-image-container{margin-left:16px}@media screen and (max-width:450px){.row{flex-direction:column}.responsive-image,.responsive-image+.responsive-image,.responsive-image-container+.responsive-image-container{margin-top:16px;margin-left:0}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}footer{background:#000;color:#fff;font-size:12px}.footer__content{max-width:900px;margin-left:auto;margin-right:auto;padding:8px}.header__logo{height:100px;min-height:80px;background:url(/opensage-logo.png);background-size:contain;background-position:50%;background-repeat:no-repeat}.navbar{border-bottom:2px solid #000}.navbar__items{margin:0 auto 16px;list-style:none;display:flex;flex-direction:row;justify-content:center}.nav-item{display:inline-flex}.nav-item:not(last-child){margin-right:40px}.nav-item a{color:#000;text-decoration:none}.nav-item a:hover{text-decoration:underline}@media screen and (max-width:350px){.navbar__items{flex-direction:column}.nav-item{margin-left:0;margin-right:0}.nav-item:not(last-child){margin-bottom:8px}}.post-content img{max-width:100%}.post-content .gatsby-resp-image-wrapper,.post-content .video-responsive{margin-top:2em;margin-bottom:2em}.post-content h2>a,.post-content h3>a{text-decoration:none;color:initial}.post-content li>p{margin-top:2px;margin-bottom:8px}.post-content blockquote{border-left:4px solid #d3d3d3;padding-left:1em;margin-left:0}.post-content pre{color:#333;background:#eee;padding:1em;overflow-x:auto}.post-content pre code{line-height:1.2;font-size:.8rem}.post-content code,.post-content pre code{font-family:Source Code Pro,Menlo,Consolas,monospace}.post-content code{background:#eee;color:#333;padding:2px 4px}.post-metadata span{display:block}.post-metadata__author{font-weight:700}.post-content .video-responsive{overflow:hidden;padding-bottom:56.25%;position:relative;height:0}.post-content .video-responsive>iframe{position:absolute;top:0;left:0;width:100%;height:100%}.post-content .table-wrapper{max-width:100%;overflow-x:auto;border:1px solid #bdc1c4}.post-content table{border-collapse:collapse}.post-content table th{background-color:#f0f0f0;padding-left:1em;padding-right:1em;width:auto}.post-content table td,.post-content table th{border-bottom:1px solid #bdc1c4;border-right:1px solid #ccc;padding:.5rem;white-space:nowrap}</style><meta name="generator" content="Gatsby 2.20.2"/><title data-react-helmet="true">Roads? How boring! Part 6: Choosing a crossing type - OpenSAGE</title><meta data-react-helmet="true" name="viewport" content="width=device-width, initial-scale=1"/><meta data-react-helmet="true" name="twitter:title" content="Roads? How boring! Part 6: Choosing a crossing type - OpenSAGE blog"/><meta data-react-helmet="true" name="twitter:description" content="Part 6 of the series about rendering the roads in SAGE maps: Choosing a crossing type"/><meta data-react-helmet="true" name="twitter:image" content="https://opensage.github.io/main-menu-social.jpg"/><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"/><meta data-react-helmet="true" property="og:title" content="Roads? How boring! Part 6: Choosing a crossing type - OpenSAGE blog"/><meta data-react-helmet="true" property="og:description" content="Part 6 of the series about rendering the roads in SAGE maps: Choosing a crossing type"/><meta data-react-helmet="true" property="og:url" content="https://opensage.github.io/blog/roads-how-boring-part-6-choosing-a-crossing-type/"/><meta data-react-helmet="true" property="og:image" content="https://opensage.github.io/main-menu-social.jpg"/><meta data-react-helmet="true" property="og:type" content="article"/><meta data-react-helmet="true" property="article:published_time" content="2020-03-22T00:00:00.000Z"/><link as="script" rel="preload" href="/webpack-runtime-0b8f65cf1cdc82f11b17.js"/><link as="script" rel="preload" href="/app-ead74e1fb7e4ab74ded4.js"/><link as="script" rel="preload" href="/styles-67af6e257ce4bdeaf9f3.js"/><link as="script" rel="preload" href="/commons-612417419248595f9faa.js"/><link as="script" rel="preload" href="/component---src-templates-post-js-c5ebc35d477cc4c4307b.js"/><link as="fetch" rel="preload" href="/page-data/blog/roads-how-boring-part-6-choosing-a-crossing-type/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="page"><header><a href="/"><div class="header__logo"></div></a><nav class="navbar"><ol class="navbar__items"><li class="nav-item"><a href="/">About</a></li><li class="nav-item"><a href="/blog">Blog</a></li><li class="nav-item"><a href="https://github.com/OpenSAGE/OpenSAGE">GitHub</a></li><li class="nav-item"><a href="https://discord.gg/G2FhZUT">Discord</a></li></ol></nav></header><div id="main-content"><h1>Roads? How boring! Part 6: Choosing a crossing type</h1><div class="post-metadata"><span class="post-metadata__author">Daniel Sklenitzka</span><span class="post-metadata__date">22 March 2020</span></div><div class="post-content"><style type="text/css">
img[src*=".gif"] {
  margin-left: auto; 
  margin-right: auto; 
  max-width: 500px;
  display: block;
}
</style>
<p>Figuring out how to render the roads correctly in OpenSAGE turned out to be a little more challenging than expected. This is the sixth post in a series describing the journey. <a href="/blog/roads-how-boring-part-5-connecting-the-road-segments">Last time</a>, we rendered road segments with angled connections. Before we examine the other connection types (tight and broad curves), let's take a look at the crossing textures:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 512px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/72568cae73fb037fad88ceedc4e416dc/01e7c/texture.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7BAAAOwQG4kWvtAAAEhklEQVQ4y61UTWhcVRR+UjsiKuKqu4Ib0UJVElOkiBUVGkFTqBKTmkkmM/Pem/fuve//f36S+c3PZCTF/CCp0CxU3IkoqODOha4UHIsLjUoTE0tSqk2TvEzi9dyXTKALdz74uPedc+6595zzncNt3tmIbayvxf5cvR7b/PtmbPOv27Gt7e3Y8vJK7NaN1dgOvROjtAWgR9jdCmPh9lbs9q0N+N+LZNubN2O/L/16H6fbTlOz7AiG4zZN12symQHQbZDrRhOrGkBtqobR1B3nyEY1rKZimHDWOjzrNzkBYcogYkIzRDkEoTKsaYSolBimQV8/dd7opUPJFOVlRDPMFiAiQlOiRIcF8cgHhzUjlIgSwk8oq1qIdSMkhhkyOfsXEQ4lAAIbuCQkIFcMK1RNK7JDYIM0Hc6ZoQIyDoQUDh/ciBWKVJ2CU8rk4PDw5SqFQ1RSYAUZhEmJbkY25HCPNQCsnJfNz9l+MA85mGGA/TsMXi7P1lkHdLbnz1uuF4HJ/HyB6eaYzsvl5p1sbt4OsvNOkJvh/vevMDbxol+r6WaQ/UaQ5LNMBi+9n61jjcajgqZdFnWjMYzJlOH5s+VK7STTwet6k4I4p+hmXZDwtOX6xfmFhUc4NSNdH5Vk6kV50r5sX7T44UcPu0HwhQe5Kzgu9SB3pXyBWn7wOfCOA5pd0VyPqo5HkWVTzXaoZhjPcASTJUeWqUGULQLFSKb5OHNYrFZf9fN5qvRfallvxXfs+NCOODC45xUK9O3L02dNy67pQBc/ld5yEsO7GZ7fT2DcyUmC+LMVH6SZ4SRF4BBI/MvC1StRyALGKc336RBEMCQhyl4kyCjBdFCoGQxyPSNta2m+JUvyfkpROjkZ4TUdqGGY5pJfKCyWamPnvvv+2j3t0CWE+qBDqGZaNIPwpbbcCbLvQU6pAqEi06QqhK0aZhdXnpzsHJ1qPPnJ198+1Da2nOA4cO9EWsYnXurueSBfLPYUq7XOw5fde+AwuACvnUaKUhVluQ6tmp2enXvwroqPlCvHo8qXSq/wkrzJS2gFumgNyL1SrNTSTJfg08euvvv+f9PGddzu9j4/MvpUNp9/NigUzhPLoiJUnuVNhA4xIbzq+KTUtgWbj5Gqrlue/xsU849ipXKtNjF5krOGEj99dfr0CxH/Uulz4z0X8lOe162CEyLJuyrC+xpR9ngxQw1wXh6bkJktTJgbAhRKhCGSkjHVXZdmC/kzQBtl3eCFD6ICyOh5JTEslkaLL+fAgRcfbHkD8X9cmDgE4RabKKw44/XGYzAcfiQDcar39e+6vW/uWZjsa6VSB5cZiK9mgTJKIvEcxuTpysXXc3XP7UbQ9AJMIIEorWRG2mVjCwPJoTsi2kCYy8kUT5PJ9F46xe8jGHl2NujisK5/RkzzU8WynoCB2gF5uViqVs9D0x9MFXDCaCMBtZK8kGjnEGjyA5tG2LD2ZbCBdg0hDafuKtDEZD0idHZk5HGobgNGVQWqXZEJqWum+RrTiVLmWFTAcvWkZttnCuVyh+l5XeP1qVNEWuT+BUx/xSNleKnNAAAAAElFTkSuQmCC'); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="A sample road texture"
        title="A sample road texture"
        src="/static/72568cae73fb037fad88ceedc4e416dc/01e7c/texture.png"
        srcset="/static/72568cae73fb037fad88ceedc4e416dc/8a4e8/texture.png 150w,
/static/72568cae73fb037fad88ceedc4e416dc/5a46d/texture.png 300w,
/static/72568cae73fb037fad88ceedc4e416dc/01e7c/texture.png 512w"
        sizes="(max-width: 512px) 100vw, 512px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>We need crossings when three or four edges of our road graph meet at the same node. There is no texture for five or more edges, so in that case the segments are just rendered as straight roads without connections (so this case should be avoided when creating maps). There is only one crossing texture for four connected edges, but we have three variants of three-way crossings. We need to decide which one to use based on the angles between the three segments:</p>
<p><img src="/0268f454979943de4f6a2433486299ea/crossing.gif" alt="As the angle between the segments changes, so does the crossing texture"></p>
<p>For each edge, we calculate the direction vector and the angle between this vector and the X-axis:</p>
<p><span
      class="gatsby-resp-image-wrapper"
      style="position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 340px;"
    >
      <a
    class="gatsby-resp-image-link"
    href="/static/a451981eca45da2d08df707d2df0ac31/9f933/incoming_road_data.png"
    style="display: block"
    target="_blank"
    rel="noopener"
  >
    <span
    class="gatsby-resp-image-background-image"
    style="padding-bottom: 150%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAeCAIAAACjcKk8AAAACXBIWXMAAA7DAAAOwwHHb6hkAAACM0lEQVQ4y52UYXOaQBCG/f8/pZ/7MU7aZNq0U9RqEkAxMYpABBNBBAFv9+3pNcQYRZMdhjnmeO59d2/vavhgsAwiNa59FF2/gwBR9Abm08gsCNJ+X43/w7R2w6fAM8uKu13lv1ZqOkBxTDvP8yzLys+aIv9GkZfn1SQJkSQJiF4LptwaUfQ8n1dnnua5eMFeq62AWZb5mznelypbVtFu78zUyt3LmP8QqbTL9UkZk27PzqDrME1s1bW2vU8L5rsXY7IAy1K70cD9PZ6fYRiwrNLO7j57RH0iE9CAFnNLdoRtQ9NYNobnwfchzYeh4t90mOJ/Mp8D18CVXILoexwPpOZoxBJ7eFg/vd4eWIVM+wL8A/jK3M5zg/mbEDPPRa9LY3utL1fZ7OsurMR9oA5YK2EKkt3UAcwwhjdlN8B0iusO0nQN07tYCSEnNMf7cnd7geW5COtY1Bcjx/k1tn+TcYtGg6KQVJPshOygtXjqnseXPXgGjQy2Tep3ha4VV+l8gkUqm4z35swb72M4BvQpfBtDF7aPiQvPhFn+sP88qzkLVh99F+4lLnXoAYIuuiOMToKliIQf8ejAmWAyxriJZvH24B2BpaAPf4hhC60Q4bbsfpg2rX2Dmx56sifkQD4LLHbIKlhnvclNqfmEJz5wUg/a7nAn4aT6ejh4e9oru+DivdXjsGyUYnn0RjsACxJxGlfLVilTRp9UnmUzzddy5DbsCv39cLJKBulAMgmSz1T7lPgH2fDbuZUABsMAAAAASUVORK5CYII='); background-size: cover; display: block;"
  ></span>
  <img
        class="gatsby-resp-image-image"
        alt="Angles between the edges and the X-axis"
        title="Angles between the edges and the X-axis"
        src="/static/a451981eca45da2d08df707d2df0ac31/9f933/incoming_road_data.png"
        srcset="/static/a451981eca45da2d08df707d2df0ac31/8a4e8/incoming_road_data.png 150w,
/static/a451981eca45da2d08df707d2df0ac31/5a46d/incoming_road_data.png 300w,
/static/a451981eca45da2d08df707d2df0ac31/9f933/incoming_road_data.png 340w"
        sizes="(max-width: 340px) 100vw, 340px"
        style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;"
        loading="lazy"
      />
  </a>
    </span></p>
<p>We then sort the edges by the angle to get a defined order for the edges around the crossing point. By a simple substraction we can determine the angles between adjacent edges (the angle between the first and last edge is a little more complicated because the sign changes).</p>
<p>Based on this information we can now choose the crossing type:</p>
<ul>
<li>If the largest angle between two edges is significantly smaller than 180°, we render a symmetric Y-crossing, because it is the only one where no two edges form a straight road</li>
<li>Otherwise, if the two smaller angles are similar enough, we render a T-crossing</li>
<li>Otherwise, we render an asymmetric Y-crossing</li>
</ul>
<p>Now that we have decided which texture to render, the next step is to choose the orientation. We need to find a vector in world coordinates that corresponds to the Up vector in texture space. We can again use the angles we calculated before and similar logic as above. In case of the asymmetric Y crossing, it might also be necessary to mirror the texture.</p>
<p>In the next post, we'll render the crossings and connect them to their neighbors.</p></div></div><footer><div class="footer__content"><p>OpenSAGE is not associated with Electronic Arts or any other company. All trademarks are property of their respective owners. Screenshots of copyrighted works are only used for demonstration purposes.</p><p>© OpenSAGE <!-- -->2020</p></div></footer></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/roads-how-boring-part-6-choosing-a-crossing-type";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-ead74e1fb7e4ab74ded4.js"],"component---src-templates-post-js":["/component---src-templates-post-js-c5ebc35d477cc4c4307b.js"],"component---src-pages-404-js":["/component---src-pages-404-js-bad1132920a1db321a76.js"],"component---src-pages-blog-js":[],"component---src-pages-index-js":["/component---src-pages-index-js-284d7b8c06489acda398.js"]};/*]]>*/</script><script src="/component---src-templates-post-js-c5ebc35d477cc4c4307b.js" async=""></script><script src="/commons-612417419248595f9faa.js" async=""></script><script src="/styles-67af6e257ce4bdeaf9f3.js" async=""></script><script src="/app-ead74e1fb7e4ab74ded4.js" async=""></script><script src="/webpack-runtime-0b8f65cf1cdc82f11b17.js" async=""></script></body></html>