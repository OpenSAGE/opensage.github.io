{"componentChunkName":"component---src-templates-post-js","path":"/blog/roads-how-boring-part-4-rendering-straight-roads","result":{"data":{"markdownRemark":{"html":"<p>Figuring out how to render the roads correctly in OpenSAGE turned out to be a little more challenging than expected. This is the fourth post in a series describing the journey. After converting the point pairs we read from the map file to a graph data structure <a href=\"/blog/roads-how-boring-part-3-building-a-graph-data-structure\">in the previous post</a>, we are finally ready to actually start rendering something.</p>\n<p>Our goal is to generate a <a href=\"https://en.wikipedia.org/wiki/Triangle_mesh\">triangle mesh</a> and then put a texture on it. For the most simple straight road segment, we need two triangles that form a rectangle. We can enable the <code>Wireframe</code> mode in World Builder to see all the triangles the terrain and roads are made of (I colorized the road triangles so that they are more easily distinguishable from the terrain):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a43e29eb75a909ee2fa9eb486d1a25cd/27524/wireframe.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADuElEQVQ4yx1RW28TRxTeP4Sg8T2+ZR07DrbX3vvuzO7sfW3Ht0AhVKhI7ROxnRRVqlCTVkSIOEVpK/UtrcQDL32vWhUUh4SAAxEtIDVEpVaeeszo6OjM5fvOd76hHj789Wh0dPzy5YvR6Nnhs9Hz0eHB03cnJ6fvJgvyeDw+Ozsbj//7EOP37/89PT09OfkHMrU3HD569Nvu7u7e8PDJ3uO94eM/fv8T6Paf7B/sHxwcPD0avRgO9169+uv4+Pj136/fvnn75sOCE+rW6o3uzUvdm0sr/Rv97lJv+cpq/3qvu/TF6vWV/idf3vq0t3z1889acNVdvgJ5pXet373a7y31e9eoTpPrNCutBaZRK9b9UqNeWqgVOk2m1Sg168V2o9RpTYpG/WLVm6t6edfOeU7OtWfrtQLVanIfL/KX2pXFduXyIttpM61m6fIiB/Viu9xpV9rNUs2fr/kXXWcOkPVqAdhrfr7dYKh6lWkuFKEPbCCaDWhSaE86F2rVfN2fd6ysSWZtI+uYUGQsI2ObWdukAUVVvULVz1XdOQjPyToW7Tm079G+DY8yrp21DFpDKR3PQEZqQlWmdZzE6jSIp3x33rEzvpNr1PJVL+u4Wc1lzRbyqnnXSgOXadBET2OU1HFKg6wlLCNNtKShzwAYPMhAT9eiDTcv24rAs6wkiLZqemXbAakJi6RMI+1asxglkBLHapKgpEVoCvgwimE1LokhSQxLapJFxRJTLAOFInISQ1zGsmcIjmo4qioRUQgqcljgAxpOUEhJIhXGiItCpFIJYDUGTZBV5JRKUeBYgeMFVtQ41cjpekpH0wIf4vmAIoVNMkO5Vg4EOxbME0NyTBYiSI2rctiwMzJhSqpY5ph8li6xZclkdJwwCcgOW3rcs2kKrHftlO/OGiQOemQZwDFZCqpKkGgxRc+UiTDPMLKet+yUoSUcM+XYMwaZdu00gGmMwrIUUqQQV5niuQBGUU2NlMvny+ULSA4SM8mTOUEMWCRikJhtwG8FJTGgoSgF7svgkxAoM+d4dkoWQ0Bk6AmsRIFOliIEHJYCMAjMaehxDYWBHd7DMwqraVmMgOEwM2CQEkJqRMcRAydsAtsofCxcKVIQKzBnzjKSNjiqgIoUJUtRlj0PHiAlrMohVZoytAmY4GlF/EiaRAgU8dyUAMFekPgpjjuHJo5Eqc17a1uDb77f3rh79zbk7ft37m+tQzHYXBsM1r4brA821zfufLWxcXtr69sHD3765ecfd3a2N+99vbPzw/9JnMLVwmpGLgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Wireframe mode\"\n        title=\"Wireframe mode\"\n        src=\"/static/a43e29eb75a909ee2fa9eb486d1a25cd/0a47e/wireframe.png\"\n        srcset=\"/static/a43e29eb75a909ee2fa9eb486d1a25cd/8a4e8/wireframe.png 150w,\n/static/a43e29eb75a909ee2fa9eb486d1a25cd/5a46d/wireframe.png 300w,\n/static/a43e29eb75a909ee2fa9eb486d1a25cd/0a47e/wireframe.png 600w,\n/static/a43e29eb75a909ee2fa9eb486d1a25cd/27524/wireframe.png 646w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h2>Generating the geometry</h2>\n<p>The first step is to find the rectangle's corners' 3D coordinates in world space.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4ab34f085fa6a53eb7d92d2b3d985566/339e3/straight_drawing.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.666666666666664%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAA7DAAAOwwHHb6hkAAABJ0lEQVQoz11S2W6EMAzk//+yUh9ot7AHCcRXtsMYUNXIGNtge2ZgcJ6I6BFv3BDTOuN+Vv6mne+r6mA8YTaKfLtX98X9BR+x0L/O9Co+3UdVQXPsS7uJzGZTxMN9dTdYhLgrNsAzTY9HG8YhQHMpZdmvZSF6MXvR0Ak4AAlcziA9impWe99ha57WHqqrSCclSZyYBVipwk5290E4T8BubcgSpn7ebrdpAhgRwWWchYl3kaqKlA92v7b2MY611mOzbBtksN7dzkOccC2JgOoJHpVycS7kXKiTk+FBMgGbdfBMzYGZE1foJ3LAhtqj2UIxhaan2vDtlB09d/efiK/cfGBUncHQvXA8rPCTps8Am2sEfoQZ/VRh+PeHpdqwjK/KlYLImwGU+gVV54UOR7j3awAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Straight road segment geometry drawing (created with geogebra.org)\"\n        title=\"Straight road segment geometry drawing (created with geogebra.org)\"\n        src=\"/static/4ab34f085fa6a53eb7d92d2b3d985566/0a47e/straight_drawing.png\"\n        srcset=\"/static/4ab34f085fa6a53eb7d92d2b3d985566/8a4e8/straight_drawing.png 150w,\n/static/4ab34f085fa6a53eb7d92d2b3d985566/5a46d/straight_drawing.png 300w,\n/static/4ab34f085fa6a53eb7d92d2b3d985566/0a47e/straight_drawing.png 600w,\n/static/4ab34f085fa6a53eb7d92d2b3d985566/1cfc2/straight_drawing.png 900w,\n/static/4ab34f085fa6a53eb7d92d2b3d985566/339e3/straight_drawing.png 977w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We already know the start and end position, so all we need to calculate A, B, C and D is the (half) road width. Different road types have different widths, so it must be derivable from the road type definition:</p>\n<div class=\"gatsby-highlight\" data-language=\"ini\"><pre class=\"language-ini\"><code class=\"language-ini\">Road TwoLaneDarkDotted\n<span class=\"token constant\">  Texture</span> <span class=\"token attr-value\"><span class=\"token punctuation\">=</span> TRTwoLane6.tga</span>\n<span class=\"token constant\">  RoadWidth</span> <span class=\"token attr-value\"><span class=\"token punctuation\">=</span> 35.0</span>\n<span class=\"token constant\">  RoadWidthInTexture</span> <span class=\"token attr-value\"><span class=\"token punctuation\">=</span> 0.9</span>\nEnd</code></pre></div>\n<p><code>RoadWidth</code> does sound promising...but how can we check if that's really the value used by the original engine? World Builder shows the 3D coordinates of the mouse cursor's position in the lower left corner, so one way would be to copy those and calculate the distance manually. Luckily for us, there's also a less cumbersome way: We can use the built in <code>Ruler</code> tool that's designed to measure distances in the map! We just need to drag a line and its length is displayed in the status bar:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fe42aacb4ba6a481f0e8b08aabd23e45/27524/ruler.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 88.66666666666666%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAD2ElEQVQ4yzVSa28bRRTd/4IUFDex48SPtePY610/1rve3dnZnd2d2WfcJg006gckiqBx80D8BRASXygtCKUE1CKaRk4j4AcgVagQx0mUhFAa0rRpRVz6iVElRlczVzM6c8499zIb938+2N//84/Dg/293d3dvb29ne2d09PT5/+vfr//6tW/L1/2afT7Z2dn/7x48fzZs6d0Z3pb3YcPf9nc3Ox2d3tbv3e7vz148OvB/kGv19vube9s7x4eHna7W0dHfz969Nfx8ZOTk6fH9Hhy8vjxEbO4MPveFf/Ku6323KVr7en23IWFeZrMLC5cvta+tLQ4e/WDi1ffn1paeGu+Pb20+PZHH15uz03Nz8/QJyZwS9jKO3bGhGOamtDUuIMygcubhqKpNWQ2IGxeaIHzUSEMCh7OeU6OOKxtpUO/xMxMN1oRZ1usCVnbzlmItVDaJfWmLMuSqGlNVW1iR2uFnO+Oh0ExCktRUA680sUpkYlC3ifjlpk1QArbOYLzk34J2816vSrLog4URWlYCLQinuI97zU/GbcRGwU8A/UUzQwjTZy8T0qWkfbIhGProlijtMgEslTTVBnbJWJlfDdvwFEX52iCcZ6hbDbKKEoc6qOmmZwMC74rKIpUqZQpJwBNiYI1ZTKUiZUiOO26WQelPMJ6eJxxcd5GCUUZpKVGQYHYdFdkuSE2qgAoUFepeFGs+54a+vlWNEHByByzzLGA5BkAkk01rqgxwxjGdpY4GceSxHoNQvW1W3JdrFaqAnF0+rsBk5Y5iu0UsbPnwxLTkEaq1QFJOgdBHMGEg1iEKLNIZcuNGtVfLpc4rmhZwPeKpp6ggdCIBoawk2UQymE7o2sjOkgAMIQgq6oSz5eKE/laTRDFClcq8AKnQy0KRaANNeSYqsUpv2kkqWzqcy5wc6HHmuaIY1FAvcxN8OViRRDq9ZogcA2xQrvuWDWKoUMF1ISsxnySYyDM2mjMd9lJbwLjlOupvFAWqiWO5wAsA73M8WW+wlXFahhC3y0EhPa5aBh0KLJM4JV1NWbCeOQVAUxW9GHBGNbcjIzTwexA651zDWdU81JNkjbCvIVogQkDJHV1CBoJxjJzihKD1AYjCeG5phSTpUGC0hhmoD7iYmp+EsG4rg6HRIhcnjhp7BQsIwP0UQZoqXr9DU2JAWUIaAMaeFOSBnRt0LNZH48RO0GcLACj9BJqw5TTgknPzvg4jxHLXP/8k5tffHpr+caXNz+7feerzvrK2r1v1jvfbmx899OPd9Y7K/c7tzud71dXl+/eXV69d6uztrL6w9c3rn+8trryHzhXqJLrHTmTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Ruler tool in World Builder\"\n        title=\"Ruler tool in World Builder\"\n        src=\"/static/fe42aacb4ba6a481f0e8b08aabd23e45/0a47e/ruler.png\"\n        srcset=\"/static/fe42aacb4ba6a481f0e8b08aabd23e45/8a4e8/ruler.png 150w,\n/static/fe42aacb4ba6a481f0e8b08aabd23e45/5a46d/ruler.png 300w,\n/static/fe42aacb4ba6a481f0e8b08aabd23e45/0a47e/ruler.png 600w,\n/static/fe42aacb4ba6a481f0e8b08aabd23e45/27524/ruler.png 646w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>So...the ingame road width seems to be about 31.5 feet, and not 35 as we suspected. It turns out the value we need to use is <code>RoadWidth * RoadWidthInTexture</code>.</p>\n<p>Now we can calculate the positions A, B, C and D from the drawing above using vector arithmetic:</p>\n<div class=\"gatsby-highlight\" data-language=\"csharp\"><pre class=\"language-csharp\"><code class=\"language-csharp\"><span class=\"token keyword\">var</span> direction <span class=\"token operator\">=</span> Vector3<span class=\"token punctuation\">.</span><span class=\"token function\">Normalize</span><span class=\"token punctuation\">(</span>End <span class=\"token operator\">-</span> Start<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> directionNormal <span class=\"token operator\">=</span> Vector3<span class=\"token punctuation\">.</span><span class=\"token function\">Cross</span><span class=\"token punctuation\">(</span>direction<span class=\"token punctuation\">,</span> Vector3<span class=\"token punctuation\">.</span>UnitZ<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> toCorner <span class=\"token operator\">=</span> directionNormal <span class=\"token operator\">*</span> halfRoadWidth<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> A <span class=\"token operator\">=</span> Start <span class=\"token operator\">+</span> toCorner<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> B <span class=\"token operator\">=</span> End <span class=\"token operator\">+</span> toCorner<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> C <span class=\"token operator\">=</span> End <span class=\"token operator\">-</span> toCorner<span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">var</span> D <span class=\"token operator\">=</span> Start <span class=\"token operator\">-</span> toCorner<span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Applying the texture</h2>\n<p>All that's left now is to apply the texture to the triangles. In order to do that, we need to assign <a href=\"https://docs.microsoft.com/en-us/windows/win32/direct3d9/texture-coordinates\">texture coordinates</a> to the points A-D. In other words, we need to find the coordinates of these points inside the road texture.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 512px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/809c180feb461678ddeaba5c824a1ea4/01e7c/straight_texture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAEhklEQVQ4y61US4gcVRQtiVmMH8RVdgFBRLNQmDFBzCIxWSRKjCAxhODMdFfXq8+rb9enu7qqq3v6V901PRNnYCYgZJJpzegyggjGlQsX7hTUrCpB0JgQspSYmk+u99WkF1m4s+Hw+r13373vnnPqcQcAJs4gWvfuTMztZBMDeDRRw3kBISAqiCriE8Qqoo7wEAZCRASIhd2YZ3gE9976evpxMp9OD4cpnyQpiQcpaXdSpdFM5ShKpSBIS76f8rUgJVE9lZrNVGm1Uwn3SRilpF5PRVzTwvDmqY0vbnLnG02QZQqiZgCxysC7HvAeoupDwbZhhlIoUBVmizzMFoogiRJQhYKCa7KiQgnnRSICFQic7faAI7Uwo6qWSZqeqYaZGaaV6WU7U20nkxFF18uKXjUr1oIckl/LaBBmhlfJdNzX8IyGZyzNyIq9OOPOLS2DZtkgGSZIugm0bINmO6A7LlDTAlnVQNGNfF3GDsRKFZSwDiRqgtCcA7EegRhGeY4zK6vAffTZ5+tifzDi4/hyCUEGyRoZzK9Jw+GamMzjfDAS+v2REMc55Lh/hSbJmjhIrkiDZMQvL49mV1ZHM6sXR8evXbvM/e+/Zj851mi3y24t+JFQ9TBbM4Nwgo3x4oWXFMNYxtYXCaULTtVfbcX9/WzPC8KzvCRf1G13SFR92fFr7QsbGy9ysm78YaKypuMBkvvduNDVjS9fqAThdcurQAU5Y2O91QbXr30LAJzlepds5LPsVcGwXRwrmMN5k6OGdUtDsrWy/QDVBZ6QaZaw1eud8qMIZkpkqyQrDwVFfTjNC9s1XFtcXnrb9iqxrOlMsAeiqm0KsrJDFGWKI7KSliQ591Ke2LJuXrpyKW9ZUrWSXa0CtoZQgN2IqGohb9mvrcgaOsAw/8GEWxi7I6nqFIdV7rJEluveqkWNEXJ05Kefbzw1bl3StHOG44DpuiCp+vnxOtKx5vg+nvOAdcZow9YPct0kmYqT5PXr3//w/DjYqQR7Zd3cJ1Bt3/GTp5+NWq3TrV489fhmT+8mDD4QqbqkmmZPouoQKQiXVi4+94Tic53OXjai6u8Shf5NFPW2opt3Jc243erGAtubJWTP+qdX/9s2qNrJ8f+oOfdGGEVvBY3mCQO/FBm/b8YbOgFYe73BvDKODRqNr/B29x0/+B0F/avV7d7oJ/P7ObzFr+i/l1kQtvAOCqCiwkf1cpkpuIke3FHN8jYqDTY+GJ1+Qlkscn5PxMeBFRUULS8cNKJDzDb3UZirj1U9gorzzU73GCMa51tY5BGKAdQw2X+w8ObJcOEVw3V/K+ALMyuQzSKRtjF+B202yc0US3cotiRI0mHFsCZLMlXnup2jxm7Ch1hsC4tssmTMDbwo5bbBBH+yhAVB3MaEO+wBqQS1g7hR/sawna8tx3kN3T6pmtaH7V58wq/XgfHIkpj4+ihoYp6IhTGHaJNfMBbwCWOUsJYzpOHAEwIl88Pc0GGz+SpWXMQDXVS7S3V9iAXfz2mh8p5cwE5vv+V5h6JOZxIFOzgYLhww5XXuX6YRwwbLRQeXAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Straight road texture coordinates\"\n        title=\"Straight road texture coordinates\"\n        src=\"/static/809c180feb461678ddeaba5c824a1ea4/01e7c/straight_texture.png\"\n        srcset=\"/static/809c180feb461678ddeaba5c824a1ea4/8a4e8/straight_texture.png 150w,\n/static/809c180feb461678ddeaba5c824a1ea4/5a46d/straight_texture.png 300w,\n/static/809c180feb461678ddeaba5c824a1ea4/01e7c/straight_texture.png 512w\"\n        sizes=\"(max-width: 512px) 100vw, 512px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The straight road covers the top third of the texture. It stretches from the left (0) to the right (1) end, so the U coordinates are easy to determine. V is a little more complicated, because it depends on the <code>RoadWidthInTexture</code>. The middle of the road is fixed at the center of the top third: <code>(1/3) * 0,5 = 1,6666...</code><sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>.</p>\n<p>A little more experimentation with different <code>RoadWidthInTexture</code> values tells us that an unscaled (<code>RoadWidthInTexture = 1</code>) road's width is exactly <code>1/4</code> or <code>0.25</code> in texture space. So for our <code>TwoLaneDarkDotted</code> road we end up with the following coordinates:</p>\n<table>\n<thead>\n<tr>\n<th>Position</th>\n<th>U</th>\n<th>V</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>A</td>\n<td><code>0</code></td>\n<td><code>1.666 - 0.25 * 0.9</code></td>\n</tr>\n<tr>\n<td>B</td>\n<td><code>1</code></td>\n<td><code>1.666 - 0.25 * 0.9</code></td>\n</tr>\n<tr>\n<td>C</td>\n<td><code>1</code></td>\n<td><code>1.666 + 0.25 * 0.9</code></td>\n</tr>\n<tr>\n<td>D</td>\n<td><code>0</code></td>\n<td><code>1.666 + 0.25 * 0.9</code></td>\n</tr>\n</tbody>\n</table>\n<p>Now we finally have everything we need to render straight roads...and it works!</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/2d8a72437f3ae2c3e2b054f4f6e1d5df/eb3fa/straight_roads_stretched.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADIUlEQVQozx1SyXLbRhTEL+SQlCuRY4ILCBDgJhIEQICYfTDYNxKRkpLtlA4+5I9SjnOQRCq2I4X2D2aSqp6qfofX3e+9UR5Pf55OH+7ufj8e3z+e3n98/OPjXx/O54evX09Pzw+fP9///fTw9Hx8fj5K/unTnSy/nI9f/rk/n++Vq2tclQ5jkzSdJWJC8YDRIUKqvbkwre+msxe2feF6F657sfV/9LYvAehh3Kf/QynKRZyYaWrmmZXGpuCTiBuc6YwZkiexKcuI6VlqxrE0sIrcyjNTlozrCoQjiMaYGhANMdH8QA2CwdYfYCQbLM7HUWRQqmMyjmOTc4MxHeHRdqs6bl+RDyKN0BHjM8o8TFeYmEAqwqEUtZ2ebfcQNggxABg7jrpxVNdVbUdd2z0lhCNCNRFPeOxuPNd2PYDDOAl4NEdYD4E06UsC4Vi22bY0HDjeIAQaxrpSFlaeW2UuB9ZZJCexMQ0DiCBBPJIqm0hMKdUQHgKoyYwQjQDQNht1ve4paWLEQhcS0ZiyESL9PJ+n2TqKd4wTiThBPN5CbEk3uREAB5RMZKIwHClpapSFmeemVBFCS5JNnvOqDA+tc3Xw922UZoIwuvF917dDuOJ8geSC8VheQSlSa18t99XqUF/uW8S4oIxFkYgi1lTougv2rdvUUCQ0gMDbBSEMIZr5OxUgTaFkVGTTrl035SJLZnUdxjET/zVzyoSMUJWTqjSaatkdqIhZiAJKZwDqCOmK4KMsNarKauvLoph07WLfrKuKZFmWZ+FP+2Vbz/ftoirNspjWtZvlDqFG4A8BMJSmXO6bRVPPD/Xqulu//sU7NPOqsDoZuLms8kldyl81J1yHRN+BPgADRHQAx1u/r9TVom6WUrjOrbqUDtahXWWZkWXavp0zPkzSSZzPKZ86nnq5+sH3X+3CAcZGGA6Uw03bvb3qbrq29lPRZ6yfCaMt123pZck6TdYxnyA4gHgU7oYkWiU1j3IgCijvp3z7Un2hat98/2rq7a7eduLgsXdb+i7239DgVwZuo+g3Er1x6078fHtTvb7F7Q0pu0AUdhj+C3C5A/VPNZjpAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Straight roads in OpenSAGE (stretched)\"\n        title=\"Straight roads in OpenSAGE (stretched)\"\n        src=\"/static/2d8a72437f3ae2c3e2b054f4f6e1d5df/0a47e/straight_roads_stretched.png\"\n        srcset=\"/static/2d8a72437f3ae2c3e2b054f4f6e1d5df/8a4e8/straight_roads_stretched.png 150w,\n/static/2d8a72437f3ae2c3e2b054f4f6e1d5df/5a46d/straight_roads_stretched.png 300w,\n/static/2d8a72437f3ae2c3e2b054f4f6e1d5df/0a47e/straight_roads_stretched.png 600w,\n/static/2d8a72437f3ae2c3e2b054f4f6e1d5df/1cfc2/straight_roads_stretched.png 900w,\n/static/2d8a72437f3ae2c3e2b054f4f6e1d5df/eb3fa/straight_roads_stretched.png 1026w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Well...it kind of works. The road segments have different lengths, and our current implementation always stretches the texture to cover the whole length. That doesn't look right.</p>\n<h2>Repeating the texture</h2>\n<p>In order to fix this problem, we need to <em>repeat</em> the texture instead of stretching it. We can easily do that by specifying values greater than 1 for the U coordinate.</p>\n<p>We know that an unscaled road width is <code>0.25</code> in texture space, and that the texture length is <code>1</code> in texture space. The unscaled road width in world space is given by <code>RoadWidth</code>, so the texture length in world space must be <code>4 * RoadWidth</code>. We can calculate the new U coordinates by dividing the road segment's length by this value:</p>\n<table>\n<thead>\n<tr>\n<th>Position</th>\n<th>U</th>\n<th>V</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>A</td>\n<td><code>0</code></td>\n<td><code>1.666 - 0.25 * 0.9</code></td>\n</tr>\n<tr>\n<td>B</td>\n<td><code>Segment length / (4 * RoadWidth)</code></td>\n<td><code>1.666 - 0.25 * 0.9</code></td>\n</tr>\n<tr>\n<td>C</td>\n<td><code>Segment length / (4 * RoadWidth)</code></td>\n<td><code>1.666 + 0.25 * 0.9</code></td>\n</tr>\n<tr>\n<td>D</td>\n<td><code>0</code></td>\n<td><code>1.666 + 0.25 * 0.9</code></td>\n</tr>\n</tbody>\n</table>\n<p>Et voilà (this time without triangle overlay):</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/42720d8dff2f0090c6d8dc2b5d971c56/eb3fa/straight_roads_repeated.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADLUlEQVQozx2S2W7jRhBF+Q15CIJJYlkWSYmkFlKURHFpdrO7uTTJ5k55GTuxM8lLkD8a58njJckADmx/YOgAF4XCebhVhVvCw8Pt/f3nuy+f7+9vHx9u//n7z6en23+fv7y9Pb29/fX2+vT6+vjy+vj68vTy8vg/HMjD8/Pd1693gu2OPDCC/jEAx/57HQHvGL6TIwhHjvODbX+P4DhA45iKcSiSYEzwGKFjCI+FPNOKQmurRZ6pYaRgqoSxGidzQmYemPhoCnzZcUUUzKJIjSIFIsl2TzwgQTQVABR9tIRo4/kLF8wGBJFIqBzHM0xkjGcBVhCaBsE0wO9ynMl2d2LtT2znRDC34mqtGaa5d1yAAEQWgCtMtDxbpqmKieT5kuuJMJApVQidxYn2Ph9OEZIFaz/e7EaWLe2duQu2HgR+AMMIpSnKczfLjCxVGJOzXGWpElAxTTXOhxsHd02AcDCemJsfdePDsM9uL+7dpR+4OMQBCUhIWIpYZrNsw4tV1y5Pe72t9K5edo0u+Ei2nNHOnuxsfWNtLcfwg0XMFlW9KziIExxFEaEhDTFLScFRwZ0sUQ6t0XdrIWHzhK0DCmGAAgIDijBFjMGicJt601R6VdiM+ZQSTCihUZKQvtl09eq0M4Sm1FmiZpkVRT4KAKF+FKMwwoPyfFmV86pQK6429a6uYZqFJXcvT3fn3e7isBF4PkyepkzqmnXO94MFoQGmfsnXp92yb41Dtx5Ul0O/bGqjbwa+5pla5guhLE2WTtt2U5SLKJayTE9zN4yGdWTOtYJrVbEsuMJzpeQaS6ScTetq2Xfmeb8dPsyoSrOqjLreFLlOiBTgIQ89jIbkJnG2qBvz0K/LckEjGWKxbtZ9b5z1m7POFEIyi6N5SOU8XUXRnNApQLLri5Z7snVGrj9GVKpbo6lWWarmXEvzWV2pdaV0zUJoL9r6Y9+cHeJk+LEj35sAWwSO4nsrjM0wXLNQaYo5z6Wzg351CS5v+M0v/OomvbyKhW+Pxt+Np998GC0c2H48gNS0zlfkt8S7Dr1rCj/F7I+Q/2r3F8n17zf1z59w+xMue8AKC8L/AKbbBjRXyJllAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Straight roads in OpenSAGE (repeated)\"\n        title=\"Straight roads in OpenSAGE (repeated)\"\n        src=\"/static/42720d8dff2f0090c6d8dc2b5d971c56/0a47e/straight_roads_repeated.png\"\n        srcset=\"/static/42720d8dff2f0090c6d8dc2b5d971c56/8a4e8/straight_roads_repeated.png 150w,\n/static/42720d8dff2f0090c6d8dc2b5d971c56/5a46d/straight_roads_repeated.png 300w,\n/static/42720d8dff2f0090c6d8dc2b5d971c56/0a47e/straight_roads_repeated.png 600w,\n/static/42720d8dff2f0090c6d8dc2b5d971c56/1cfc2/straight_roads_repeated.png 900w,\n/static/42720d8dff2f0090c6d8dc2b5d971c56/eb3fa/straight_roads_repeated.png 1026w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>The segments are still disconnected of course...we'll tackle that <a href=\"/blog/roads-how-boring-part-5-connecting-the-road-segments\">next time</a>.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">\n<p>When we try to use this value, the textures are still a little off. Apparently the original engine used a truncated constant of <code>1.666</code> as an approximation.</p>\n<a href=\"#fnref-1\" class=\"footnote-backref\">↩</a>\n</li>\n</ol>\n</div>","frontmatter":{"slug":"roads-how-boring-part-4-rendering-straight-roads","title":"Roads? How boring! Part 4: Rendering straight roads","summary":"Part 4 of the series about rendering the roads in SAGE maps: Rendering straight road segments","author":"Daniel Sklenitzka","date":"2020-02-25"}}},"pageContext":{"slug":"roads-how-boring-part-4-rendering-straight-roads"}}}