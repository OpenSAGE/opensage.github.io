{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/roads-how-boring-part-5-connecting-the-road-segments",
    "result": {"data":{"markdownRemark":{"html":"<p>Figuring out how to render the roads correctly in OpenSAGE turned out to be a little more challenging than expected. This is the fifth post in a series describing the journey. In the <a href=\"/blog/roads-how-boring-part-4-rendering-straight-roads\">last post</a>, we rendered road segments for the first time, but they are still disconnected and overlap each other:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/761b6775be893394d83ee92f353f21ca/eb3fa/disconnected_segments.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADHElEQVQozx3N627jRACGYV8ESKjbJnbi2LFzaHyaGY9nxp6Tp2M7zabQFQsIdRHcE+pKCLYhiC2rbrvA9aEiPb9e6dPnHA5v3727/e3Xnw+Ht3d3t8fj7f37Xx4fDv/+8+enp+Pj4/Hjx+OHD4e/7u/e3989PByfnv54eu6///3p6KTZiyQ9gWhEqMvYs6oaUeoK4WnpKTHhtUfJCKJTAE9qOua1y+iY0RFjYwdXPufzug5YHRDio3KKsG9MbLultbFpI2sWrZ5rNZdiRqgP4DTNXAA8Qn2nxJO6ngHoAuhC5FE2MybeXa6MmSsd6mdzpSOlogK5WTHOi1FZuqTyEZo4vJ4JMaN0Qpnfmng7LLt+0Xertg2HPt72q8thoXWM8BQij9U+pZOKTDF5/nO4WEqVsSYVMhj6aBhW3bDuu0XfR0MXb/vlfndubcRlWOJpRQKEY4T9irrdxdzhsuKyUa3e7aqhj7uLaP9yfbVbWRtZu9BtyKXf8JCQGa6msFznAGACWZ0Nw8axXaNb1Rptrdxdri+3sbVzY3xjQqmDtg27bt73y5oFBVqvNpvzNFmepwVMCQmc7VALKZTmQtb9UHV90ZpcqEzqRMiNUKnWhdYZodk6zTbPy00Bi6aJOA+d7YAbzqSmsuWNbEjDSkrx/0pCAEJZAZI8T/M8g0VSFACVtgPWLrWJnL5PlF7rFlLOEcEZhEWJUFViUiGMcwCSPDtPktUmAXAjZGIM2g7Lto0YmzjmIrY2urBJ2xacb5ROrQV9VxqTC5GUZZykfgEihFe4WkkZKxVcmEUjZqwJHGNiqcKG+0IEDZ8ZM7ddbEwkVcCYl+VneXEK4BhADyCvKMYV8YVccr5o+Nxp21DwgJAJo1NCfalCbULOfcrGAJ1C7MHSQ+UUwAmu/DR/AeEZZX5Zurj0nKvX+6tvr/evr/d7o+Siqae0dDmJWpHJJhNNhkFY5pMsPUF4xHjUvRTDXl7sGtMz5/Mz7wtv9tnpxF1srr7/Tm0rcL3gPyl6o6sbRd+0/EcFr8/VQL+++earmx/0qzdid133X4Ka/wf/0PMuW3r6AgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Disconnected road segments\"\n        title=\"Disconnected road segments\"\n        src=\"/static/761b6775be893394d83ee92f353f21ca/0a47e/disconnected_segments.png\"\n        srcset=\"/static/761b6775be893394d83ee92f353f21ca/8a4e8/disconnected_segments.png 150w,\n/static/761b6775be893394d83ee92f353f21ca/5a46d/disconnected_segments.png 300w,\n/static/761b6775be893394d83ee92f353f21ca/0a47e/disconnected_segments.png 600w,\n/static/761b6775be893394d83ee92f353f21ca/1cfc2/disconnected_segments.png 900w,\n/static/761b6775be893394d83ee92f353f21ca/eb3fa/disconnected_segments.png 1026w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Ignoring the different curve types for now, let's consider angled connections. We have two overlapping rectangles (one for each edge) that have an intersection point at the common node position (<code>End1 - Start2</code>). We want to modify the two corner points <code>B1</code> and <code>A2</code> so that they share the same position <code>X</code> (and then do the same for the other corner).</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3665dfa5143733368676135189c52494/75a80/angled_drawing_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7CAAAOwgEVKEqAAAAAqElEQVQoz5WS4Q7DIAiEff/nbRE4waVlIQ1zi7s/xtMPyGmbe3L33nsx2yY5xlBVM/sPDtLd55xmRkRZou2TIWYeY2zBZpak3woTgLs3AHGjaMCZBUAhn/1bLIUE0KmLqKoWMk5j20qAocg2mSV5waqaAZSoAMjdPUs8yQsmorCeinFE5DiOKP1Jfh07m9utJXnBSzffKcjzPJd33mPbh9xdRJj5xy94Acg/BWoaNtm0AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Intersection point X of two road segments\"\n        title=\"Intersection point X of two road segments\"\n        src=\"/static/3665dfa5143733368676135189c52494/0a47e/angled_drawing_1.png\"\n        srcset=\"/static/3665dfa5143733368676135189c52494/8a4e8/angled_drawing_1.png 150w,\n/static/3665dfa5143733368676135189c52494/5a46d/angled_drawing_1.png 300w,\n/static/3665dfa5143733368676135189c52494/0a47e/angled_drawing_1.png 600w,\n/static/3665dfa5143733368676135189c52494/1cfc2/angled_drawing_1.png 900w,\n/static/3665dfa5143733368676135189c52494/75a80/angled_drawing_1.png 1134w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>So, how can we calculate <code>X</code>? With the graph we created in <a href=\"/blog/roads-how-boring-part-3-building-a-graph-data-structure\">part 3</a>, we can easily find the neighbor segment and its start and end position. For both the current and the neighbor segment, we can calculate the direction vector's normal (<code>directionNormal</code> and <code>neighborDirectionNormal</code>). We can calculate the average of these two vectors, normalize it and get a direction vector <code>toCornerDirection</code> pointing from the node position towards <code>X</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4bb15082970bc3147689ce553d0373ba/9f21b/angled_drawing_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7CAAAOwgEVKEqAAAAA50lEQVQoz43T0W7DIAwF0Pz/L+5hkxptlVp1EwRjsH09pXRrlJBl9w3EAWTM4L2IiJn5UQZbBLDKNgVSlfsQKSUi2sV6j7SoUKKc2Ezb4TFGEdnFf99WVQEcYBEJITS5XCwie9jMHpiZY4zdym0xgHbMsNyp1nqIf+UTtxVbv8JLuS7Y1os+8Up28I8vIqjZKShPgM522zZDt5IAmAoHO0dM2UVR56bxf+HZS8X7+UIY3V+BFyC0+SXGTuYr1jK+fXx+BSbKvSbdwe643fx6pdOJx9EvF+R80J6rJ/ZalYuVIil575N9A9cfeicuDOPhAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Direction vectors\"\n        title=\"Direction vectors\"\n        src=\"/static/4bb15082970bc3147689ce553d0373ba/0a47e/angled_drawing_2.png\"\n        srcset=\"/static/4bb15082970bc3147689ce553d0373ba/8a4e8/angled_drawing_2.png 150w,\n/static/4bb15082970bc3147689ce553d0373ba/5a46d/angled_drawing_2.png 300w,\n/static/4bb15082970bc3147689ce553d0373ba/0a47e/angled_drawing_2.png 600w,\n/static/4bb15082970bc3147689ce553d0373ba/9f21b/angled_drawing_2.png 706w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now we need to multiply this direction vector with the correct length to get to <code>X</code>. Considering the right-angled triangle <code>End1 - Start2</code>, <code>X</code>, <code>B1</code>, we know that</p>\n<p><code>cos α = (roadWidth / 2) / toCornerLength</code> .</p>\n<p><code>cos α</code> can be calculated without actually knowing the angle by calculating the <a href=\"https://en.wikipedia.org/wiki/Dot_product\">dot product</a> of <code>directionNormal</code> and <code>toCornerDirection</code>.</p>\n<p>This gives us</p>\n<p><code>toCornerLength = (roadWidth / 2) / Vector3.Dot(directionNormal, toCornerDirection)</code></p>\n<p>and finally the vector to <code>X</code>:</p>\n<p><code>toCorner = toCornerDirection * toCornerLength</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/04fa1d59d12c4b97316a592dada284b7/9f21b/angled_drawing_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 74%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7CAAAOwgEVKEqAAAAA80lEQVQoz5XT226EMAwEUP7/G6tK+1SpRaq4JDixPVORsLuUDVSdJwg6sQmmYyuq6u78K53vAngWn8dopuUWIYQY4ym2Ei0x0xjiPIjDzA3wUZZsdoqP3cJhzEJNzAuXTFy0/WDjONb3BCiBEikzZznF7r5hEZmm6fnA1i1IJvL13ADUMt1+p5xzNXCarhcZ7Mk38vO+y0M+MQqqvq6sGGvlRAqZX+TxwPZ+7dx+tX2QDXz3yR2uTGh0e4U3rylNuPXQQpsD1519Q4dLSLcvaKH1UI4Y5yH9/WPov4cY1vwD1z7neZvtduXr/8bM3F1Vm+P5Ay2iexEHi025AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Cosine\"\n        title=\"Cosine\"\n        src=\"/static/04fa1d59d12c4b97316a592dada284b7/0a47e/angled_drawing_3.png\"\n        srcset=\"/static/04fa1d59d12c4b97316a592dada284b7/8a4e8/angled_drawing_3.png 150w,\n/static/04fa1d59d12c4b97316a592dada284b7/5a46d/angled_drawing_3.png 300w,\n/static/04fa1d59d12c4b97316a592dada284b7/0a47e/angled_drawing_3.png 600w,\n/static/04fa1d59d12c4b97316a592dada284b7/9f21b/angled_drawing_3.png 706w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Now we can calculate the new shared corner positions <code>B1 - A2</code> and <code>C1 - D2</code> by adding and subtracting the vector to the shared node position.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3c385d0495369c6fc20f4589b1075e44/75a80/angled_drawing_4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.33333333333333%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7CAAAOwgEVKEqAAAAAp0lEQVQoz5WRjQ4CIQyDef/n1cGtW2dwisnuNNiQEH6+rYUWeyIpImWzbZJmBsDM/oOTJBkR7t57XyXaPpnLMcYuXMjVHwDJBsDdeRLUofOokKns33IqpNP7HXpYBM/kstNW7RKVQYwwfS0vn6CpavmAJSiPAVXN24WcsIhk+qKIUMXtJuaWVgr51fYnHua4JCecbX/AOni8nVdYRDL2WXiqixmuqz8AFocFj5VpUqgAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"New corner positions\"\n        title=\"New corner positions\"\n        src=\"/static/3c385d0495369c6fc20f4589b1075e44/0a47e/angled_drawing_4.png\"\n        srcset=\"/static/3c385d0495369c6fc20f4589b1075e44/8a4e8/angled_drawing_4.png 150w,\n/static/3c385d0495369c6fc20f4589b1075e44/5a46d/angled_drawing_4.png 300w,\n/static/3c385d0495369c6fc20f4589b1075e44/0a47e/angled_drawing_4.png 600w,\n/static/3c385d0495369c6fc20f4589b1075e44/1cfc2/angled_drawing_4.png 900w,\n/static/3c385d0495369c6fc20f4589b1075e44/75a80/angled_drawing_4.png 1134w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>As we saw in the <a href=\"/blog/roads-how-boring-part-4-rendering-straight-roads\">last post</a>, it's also important to adjust the U texture coordinate accordingly to avoid distortions.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e65d32361fac9e3b211e7d0110ae5a05/eb3fa/connected_segments.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7CAAAOwgEVKEqAAAADMklEQVQozx3R6U7jRgAAYD9DpfYHEDA5HDsmPmKPPeM5bM/4GF+5ICywsCwrtdK+EuVPFQJqC6uF7gNW7SN8+pTd7ven54ft9n63e3jc3m+3909PD6+v2+/fn19fH19eHt/fn9/edm9vu/f3px//PP94f/r27fHPv/74+2WrpMkxT48ZUyN8FAQ9z98P4SHBRwDs+8E+jHqUHiF0gHGP4F4U9UBw4Pl7nr8Hwn2lLCaVNIXQCR0G4XEABxANuDCkNGU5KQu9yI080/NszLnG4hFEAw+oAByjaKBwoeW5ngkt5RomgzTRqmqyWljz5qSpjKrUK2lIaWSZAaEawmPPP7SdA9s5BEBV2tqcd6aUWl7oi266WTvrpXW2ctvarCujqsxSTpJUp2xE6RChvuMeWPbBzFODQFWaxqlrIHKQZUZT621zUkgz5eMs16U08txIuYFQP4oGjGmMjjx/NLUP3dk+IQNFVpjzJOFpwkNCh36g/s8eYjIQmZ6KMSIqwoMQDjHps9gBYeiHAISuyCwlK0JEcBgh1/dBOAqhCpEaokNC+gkf5MVY5KOsMOJkzBIX4oglDDMacyyEqSBiuT6YBcDxfERAKjwaOyxxWepw4eYFqGpUyiArIE0YjikiUSySrvNKOVESbtGY0BingqUijnmCCAkgAhCGUQRxhCnBlNKYxjxhPGYJWy7J6dquG0NpGruUMc9YlidxSgGCrg9s13VmruN5ru8HEQpxFGKEKaFpWrd80Zldq9eVplTSnHeerGZZ6cd8htmUJjaNbUwtTKeJsLPCqhu/naOqCesGdnN3tZwuu/+CFS70lA8x6zM+4oUuck0Uesw1HI+SbFSUWteOlwuj66Ztd9I0etcam417uQEfTl0looMkHYtcayq9rvRFd9LNJ1JqZTUsZH+xNFfr6dnZrGqt5dKRciiL/uXGOl2fnK8dZXGx2txeXHy6uLlubj8GlxtrXo07aW4W8HQONyt8NvdXnZNLvZDDrrPXH8TVTXV1W13flMrPPfUXdfjTnno0ca5+vV1f8viTXXzN6eecfM7YXVF8LfgdaDf85rfr8y9f8vM7sTyP21OY8n8B0bb6N0DNIu4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Connected road segments\"\n        title=\"Connected road segments\"\n        src=\"/static/e65d32361fac9e3b211e7d0110ae5a05/0a47e/connected_segments.png\"\n        srcset=\"/static/e65d32361fac9e3b211e7d0110ae5a05/8a4e8/connected_segments.png 150w,\n/static/e65d32361fac9e3b211e7d0110ae5a05/5a46d/connected_segments.png 300w,\n/static/e65d32361fac9e3b211e7d0110ae5a05/0a47e/connected_segments.png 600w,\n/static/e65d32361fac9e3b211e7d0110ae5a05/1cfc2/connected_segments.png 900w,\n/static/e65d32361fac9e3b211e7d0110ae5a05/eb3fa/connected_segments.png 1026w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p><a href=\"/blog/roads-how-boring-part-6-choosing-a-crossing-type\">Next time</a>, we'll take a first look at crossings.</p>","frontmatter":{"slug":"roads-how-boring-part-5-connecting-the-road-segments","title":"Roads? How boring! Part 5: Connecting the road segments","summary":"Part 5 of the series about rendering the roads in SAGE maps: Connecting the road segments","author":"Daniel Sklenitzka","date":"2020-02-28"}}},"pageContext":{"slug":"roads-how-boring-part-5-connecting-the-road-segments"}},
    "staticQueryHashes": []}