{"componentChunkName":"component---src-templates-post-js","path":"/blog/roads-how-boring-part-5-connecting-the-road-segments","result":{"data":{"markdownRemark":{"html":"<p>Figuring out how to render the roads correctly in OpenSAGE turned out to be a little more challenging than expected. This is the fifth post in a series describing the journey. In the <a href=\"/blog/roads-how-boring-part-4-rendering-straight-roads\">last post</a>, we rendered road segments for the first time, but they are still disconnected and overlap each other:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/761b6775be893394d83ee92f353f21ca/751e3/disconnected_segments.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.97270955165693%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADEklEQVQozx1S6W7bRhjkMxToDzuNRVKiKJGiRPEm9yT34C3LdlI0KeAGCdB3Sv2jcO0IKZygtpO+X1fFDhZ7zHzH7mj39zd/3X68vf346f7m7u6Pz59vvjz8+e358O/3v5+fD89Ph38eD1+/3j883D18uX98PKgrdf709On7t4O2DU6D8DQvJgjphOgY6UUxwcSoKl0wk1VmiXUIXibpizx/odb0yJkQPMF4oiE0p6WNyRxjC8BZmk0BstrWbbtV2ziNXLa1I8VCMLssj4Q4MYNQzzITopkG4FTJoniSZkaaG4TaXefuxpWUNhe2OGIhpFNWdphMokSP4jMITFBMs3yqVXReljOIlOyYcBhWXe927VE8Dqux83aDW1aLNDfzwiT0yFQ5czBLUl2r2LpiIaY+F9Y4uP3gdf2675yhd4bO2Y3efreu6wUp7SxXpS7SYpmBKabG0C01WqKKl7IW+/O4bxdKdnmx2Y9u0y5VIUxYJbdUL6rbAlhJ5sdZWsCkYsFut9FkXSmlkGLoyfnojKNbN/OmtoScczGvpd33Ttu4EM7DxPc2/iYIPD/Iig0EltZ1rFKDUy7IMOZtFwsZVTxk3C+Zz3goRCy4YkfrbeAH29XGL2BM6ZwxR+s7TCgUklSiJBUBBOUIFf8jAyBJ0yCOt1EcxFGUxn4UAwiGIaxrVzZLlTnk3OMSQkqSIg/TNMmzHBQFBKnaKmUYrH1fpS3Ahom4bZNxcDizETa1pnHUw9SNKi+i5UbWkbru+1zIoCz9JF1sg1mSuWnuQbgSwuHcbmoX0ykpF1pdOxVTJpupWX1426pYSymXjFsF0IPopzhR3tST1Dgi0RGxK+7R0imVWMoFJTOETARNhK2jq6RNqQngWZKdpYWRFWaaKUyVSbbBiYoI0TTPjSIztKu3VxdvX1/+8mo3ElbZFJsoNzjxRBWyMqR4m0dWFplhcAKgQfl6vJTdvmp2tO6w9uOZcWLMfzideAV5df0G9WH264b93sDfOHzHyYcGv8fZxabb8zcfrvfX79nVNTv/GTXnMcb/AX3L818RojzmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Disconnected road segments\"\n        title=\"Disconnected road segments\"\n        src=\"/static/761b6775be893394d83ee92f353f21ca/34e8a/disconnected_segments.png\"\n        srcset=\"/static/761b6775be893394d83ee92f353f21ca/d4214/disconnected_segments.png 150w,\n/static/761b6775be893394d83ee92f353f21ca/135ae/disconnected_segments.png 300w,\n/static/761b6775be893394d83ee92f353f21ca/34e8a/disconnected_segments.png 600w,\n/static/761b6775be893394d83ee92f353f21ca/fea0e/disconnected_segments.png 900w,\n/static/761b6775be893394d83ee92f353f21ca/751e3/disconnected_segments.png 1026w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Ignoring the different curve types for now, let's consider angled connections. We have two overlapping rectangles (one for each edge) that have an intersection point at the common node position (<code>End1 - Start2</code>). We want to modify the two corner points <code>B1</code> and <code>A2</code> so that they share the same position <code>X</code> (and then do the same for the other corner).</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3665dfa5143733368676135189c52494/372fc/angled_drawing_1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.1957671957672%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7CAAAOwgEVKEqAAAAAoklEQVQoz5WSWQ4DIQxDc//rInZCm+LKbcmMRP3DknnEjkYexyqlbDdySKqqwWOMv2FjDMYTtVbsj2CSUEqp934E6xKPc05e2l6426Wztc4mJDm81ppg0V+Z1ZxKyZUT/iatiqOgrc+Zc4ZDT34GNpYu0/Yl9vHDE+sAbz61kSEEhPLku7O3zZzGo+rJ28yEUY0xXkZ72bafBt9tMsMY293rT9crBWWUDBrmAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Intersection point X of two road segments\"\n        title=\"Intersection point X of two road segments\"\n        src=\"/static/3665dfa5143733368676135189c52494/34e8a/angled_drawing_1.png\"\n        srcset=\"/static/3665dfa5143733368676135189c52494/d4214/angled_drawing_1.png 150w,\n/static/3665dfa5143733368676135189c52494/135ae/angled_drawing_1.png 300w,\n/static/3665dfa5143733368676135189c52494/34e8a/angled_drawing_1.png 600w,\n/static/3665dfa5143733368676135189c52494/fea0e/angled_drawing_1.png 900w,\n/static/3665dfa5143733368676135189c52494/372fc/angled_drawing_1.png 1134w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>So, how can we calculate <code>X</code>? With the graph we created in <a href=\"/blog/roads-how-boring-part-3-building-a-graph-data-structure\">part 3</a>, we can easily find the neighbor segment and its start and end position. For both the current and the neighbor segment, we can calculate the direction vector's normal (<code>directionNormal</code> and <code>neighborDirectionNormal</code>). We can calculate the average of these two vectors, normalize it and get a direction vector <code>toCornerDirection</code> pointing from the node position towards <code>X</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4bb15082970bc3147689ce553d0373ba/9dbfb/angled_drawing_2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.93767705382436%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7CAAAOwgEVKEqAAAAA4klEQVQoz43S2w6DIAwAUP//HzVbskQz44MClktbViXZVFDXEJWkB5C2ilkws/denvEuKt6EQDvjbIAIE9Zay0KnOOxDKwOzQ8Q0Hcfx4gjVdiLZh1RZ5erY6eWcM8YkueWyXJFJJhFVCSilBOdJRZzk7tjpP2/xV/5w2j/3h+lWHi8s9wHDmSzgdbfFi/LAMKGH5QpzWcbr/gGMN1PsJnIQiQryDK+1Miq0Q4fxFblhrqWc1+3J+14lpR/PtwaQMlrn4r8Ykfs+DsNYN75t5ZtLBS//83JF1sogGQAo/VPq8A8xnXo9DQoiDwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Direction vectors\"\n        title=\"Direction vectors\"\n        src=\"/static/4bb15082970bc3147689ce553d0373ba/34e8a/angled_drawing_2.png\"\n        srcset=\"/static/4bb15082970bc3147689ce553d0373ba/d4214/angled_drawing_2.png 150w,\n/static/4bb15082970bc3147689ce553d0373ba/135ae/angled_drawing_2.png 300w,\n/static/4bb15082970bc3147689ce553d0373ba/34e8a/angled_drawing_2.png 600w,\n/static/4bb15082970bc3147689ce553d0373ba/9dbfb/angled_drawing_2.png 706w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Now we need to multiply this direction vector with the correct length to get to <code>X</code>. Considering the right-angled triangle <code>End1 - Start2</code>, <code>X</code>, <code>B1</code>, we know that </p>\n<p><code>cos α = (roadWidth / 2) / toCornerLength</code> .</p>\n<p><code>cos α</code> can be calculated without actually knowing the angle by calculating the <a href=\"https://en.wikipedia.org/wiki/Dot_product\">dot product</a> of <code>directionNormal</code> and <code>toCornerDirection</code>. </p>\n<p>This gives us</p>\n<p><code>toCornerLength = (roadWidth / 2) / Vector3.Dot(directionNormal, toCornerDirection)</code></p>\n<p>and finally the vector to <code>X</code>:</p>\n<p><code>toCorner = toCornerDirection * toCornerLength</code></p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/04fa1d59d12c4b97316a592dada284b7/9dbfb/angled_drawing_3.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 73.93767705382436%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAIAAABr+ngCAAAACXBIWXMAAA7CAAAOwgEVKEqAAAAA7ElEQVQoz5XSy5aDIAwAUP//E3vOrKabrorFKJhXg3GoHbGPLFAOXhNjOt2FiMzzbKu+i042YTCNNMLETI6HYbAXHWLcBmG8AcTMQkRIjNcRXpTQbTfG7VFGxay0rIlflu2XnDPAmsTwFDWBjr3CUrK0+sLMnYMYo+F6xrTe5FZCl09ll69ErNh9Ur2o/qiGv/xVPrDnr952hCuerOeq807+b9jWGxYueF/tIV56XrxJqzzJoWxj/2dWAQQ990ULN+QhLj0TigF/w2KZ34/n86iW/KdzbxNqPzKl9AV2fw3B5qduPy27Nt+jeXoHaOB7JmEOEMEAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Cosine\"\n        title=\"Cosine\"\n        src=\"/static/04fa1d59d12c4b97316a592dada284b7/34e8a/angled_drawing_3.png\"\n        srcset=\"/static/04fa1d59d12c4b97316a592dada284b7/d4214/angled_drawing_3.png 150w,\n/static/04fa1d59d12c4b97316a592dada284b7/135ae/angled_drawing_3.png 300w,\n/static/04fa1d59d12c4b97316a592dada284b7/34e8a/angled_drawing_3.png 600w,\n/static/04fa1d59d12c4b97316a592dada284b7/9dbfb/angled_drawing_3.png 706w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Now we can calculate the new shared corner positions <code>B1 - A2</code> and <code>C1 - D2</code> by adding and subtracting the vector to the shared node position.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3c385d0495369c6fc20f4589b1075e44/372fc/angled_drawing_4.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 67.1957671957672%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAIAAAAmMtkJAAAACXBIWXMAAA7CAAAOwgEVKEqAAAAAsElEQVQoz5WS2w7DIAxD+f/PndZCrswlFUPQScwvhYgTO5RUt5VzdvexkjZJMyMiVf0bBgMYCziPLdI+2cOLyBY8kTEzKqhjnazJF5m6CFCdyFAphZlTfGxRPqRkkL6SYXvFDtsp7eXsJlSFPbb9zDhI0qbngcWZFdfzSF4wbg/Je/tROPp+nRgq4Im8ndfYPT5crQ2+kj9n/j4srVwqEa/kHRuPJn7dJGkqpzLZY+sPFfgFgTIiGucAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"New corner positions\"\n        title=\"New corner positions\"\n        src=\"/static/3c385d0495369c6fc20f4589b1075e44/34e8a/angled_drawing_4.png\"\n        srcset=\"/static/3c385d0495369c6fc20f4589b1075e44/d4214/angled_drawing_4.png 150w,\n/static/3c385d0495369c6fc20f4589b1075e44/135ae/angled_drawing_4.png 300w,\n/static/3c385d0495369c6fc20f4589b1075e44/34e8a/angled_drawing_4.png 600w,\n/static/3c385d0495369c6fc20f4589b1075e44/fea0e/angled_drawing_4.png 900w,\n/static/3c385d0495369c6fc20f4589b1075e44/372fc/angled_drawing_4.png 1134w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>As we saw in the <a href=\"/blog/roads-how-boring-part-4-rendering-straight-roads\">last post</a>, it's also important to adjust the U texture coordinate accordingly to avoid distortions.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e65d32361fac9e3b211e7d0110ae5a05/751e3/connected_segments.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.97270955165693%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7CAAAOwgEVKEqAAAADLElEQVQozxVR2XLjNhDkH+QpldTqsGSJhyiJ4imQBEGCBC/w0mXJR3mt3c1DNr+02TxkbcmblB2X5XxgkKoGagozPd2D4Y7Hrwzf7r8cDl/vv315ePj9+/c/Xl4OLy/Hp6eH538Ob6fH19fD6fV4Oj3++/b4djo+Pz/89fefT8/3XIT7Ie4j1HPcM8tqG2aLBa7bNc2WBVou7Hpe13HaHux4sO24HfP/mnem+W4OWhzNxnk2DiPJhYM5OJ/bAxcOk0TOc/YuZ6mUJKMkluJYjEIBIR7YA8PssUpWzxEipKlECI9DwYXnMRHLcrxaKHUxLuiIZhLNR3kuh6EIwBmw+5renqkdVevOQZ+rynFTy2kmZPmIcbbr2XqpbJZqSeWikHM6zjI5CETkD5E3AKA3U1uK2jGZ+PyMK0s9pxaJjSQRqlIuy0mcymEkphkTHMXJCGOJCUKP930eeYKqDaezjmG12QhckvoRwUGEw0hjts15DzhD2xkwKcYMwqHjsb8cslGRz3vIsObAAKbtqnEy5XDkuh60bFu3NAuc23bfds5sp4v885AwvkBSgbAuWESBZUPoh76LUEhsEo044OqqaepzSzNNhC0c6ShQfawFoUpiPc3mtHDS3CKJ6wU+DDzGTzJcVkqeT7iQmBDBIERhxPphhAOWZkYYgOs6EEKEGBDLROygKMabjb1cTGkhcVVlxUkQJz6JsRd4JgCqYc40TdU11TCYIwBdBhu6no8wIXWNmkqqSqmgAlcW07o2s1wnqYWw6vkKwjPm3EVTFEzDeJZks6oGZe3QApSV3TQK22VTjhbNhIuIFIQD6A8wEaNEjBN2SygUPMxHMZ9ToanF5UKu6mlVj8tCXDTjy51xfWFebjQOBTxmW03FkoplIS+bSVXLWTbM6DDLB6v1dL1R1hudVspqOUviflPyV1tls5pcrlVudbPZfbi6fr/b3yZ3N8ZuPa1SYVnMtkt709jbFbyotUWlkpSnhVAvjO11evOe3uzp7W3G/djp/dTjf/i5q8Bg/+tduXPxJz35TOE+Rh/j4Jc8/S2Mbq31Fb37/GG1/0Qu7qLlDtElwMF/3Wr6ciCO6twAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Connected road segments\"\n        title=\"Connected road segments\"\n        src=\"/static/e65d32361fac9e3b211e7d0110ae5a05/34e8a/connected_segments.png\"\n        srcset=\"/static/e65d32361fac9e3b211e7d0110ae5a05/d4214/connected_segments.png 150w,\n/static/e65d32361fac9e3b211e7d0110ae5a05/135ae/connected_segments.png 300w,\n/static/e65d32361fac9e3b211e7d0110ae5a05/34e8a/connected_segments.png 600w,\n/static/e65d32361fac9e3b211e7d0110ae5a05/fea0e/connected_segments.png 900w,\n/static/e65d32361fac9e3b211e7d0110ae5a05/751e3/connected_segments.png 1026w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Next time, we'll take a first look at crossings.</p>","frontmatter":{"slug":"roads-how-boring-part-5-connecting-the-road-segments","title":"Roads? How boring! Part 5: Connecting the road segments","summary":"Part 5 of the series about rendering the roads in SAGE maps: Connecting the road segments","author":"Daniel Sklenitzka","date":"2020-02-28"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"roads-how-boring-part-5-connecting-the-road-segments"}}}