{
    "componentChunkName": "component---src-templates-post-js",
    "path": "/blog/roads-how-boring-part-8-rendering-crossings-continued",
    "result": {"data":{"markdownRemark":{"html":"<p>Figuring out how to render the roads correctly in OpenSAGE turned out to be a little more challenging than expected. This is the eighth post in a series describing the journey. <a href=\"/blog/roads-how-boring-part-7-rendering-crossings\">Last time</a>, we started rendering crossings and found the formulas for calculating the rectangles in world coordinates based on the parameters <code>RoadWidth</code> and <code>RoadWidthInTexture</code>.</p>\n<h2>Texture coordinates</h2>\n<p>Now we need to find the coordinates of these rectangles in the road texture, just as we did for the straight roads in <a href=\"/blog/roads-how-boring-part-4-rendering-straight-roads\">part 4</a>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1da157f61d15aed7f18fa04587e9a228/01e7c/crossing_texture.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 100%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAFbklEQVQ4yz1UaWxUVRQ+RmRRolFeI0iiAsWIGqNGrQYiwaoElIAWhu6zvH3fZ957M/Omy9DaUiiUliYmwHS6TUEQsEQU3KIJRn9h9Id/NGqmiUYJBGOZofaYNxhzc3Jvvvud9Z57ID8+SuTyeeLYSI6YKEwSYxMFYmyyQBw5NkKMjY8SU1PjROH4JHHug7PE+fNniFPvnSQKUyeIsYlJIj+aJ06cLBDnpt8lClOFqrHxiSpQDLOoGFYx2DXLLmpWvKiaVlEzA8woSqpa5GW5yElyUdTUW3eWXeFLml4UNa0o63qAzeh2fAZIjkeS5ZHiBaQFsSKMICAjiBhjWAyTFEZoBpsjUWyOxpBkuVs8XqjoRCgGwxSNFHfLBoiaUeZkpcyIUplXtLKkGWVJN8qippd5RS0zglRmJbksKGqZl5WypOllxTArUuGpWoUb6MmGVQZWkv+PJhZ450VkRAkDPPAY4IH3SkQcjwwvICfJyP7HqYgY2JAqGCT9TDKRTKUsx4nHPc9xUn5FUn4m4XlJx/O8lBscXDfpOG7S81KJdFt7wvGSt1ba95KptOclU57nZxxwUj4opgk16zeArBtgxR1QUj4MNLXAu69tht5QCDpJEtoaGmCwNQwfPlcDWVWHDoqGvi1bwacY2FMXgv0NTeC4HkC6vaPZ8/0h3Y7/GGO4pxsNE1oGBpYC4qJYLrcl6nlnQn37JkPZ7JTS1XWi9pPP1gHi4vDevZlmw7qw/cDAqfqUf47atz/f8M3Xy4AVpWtB7kEdFcM4vYHmABBvo6anX4yb1g8swyIfTyCraqirGtqud3494koqmbzIUDTSplWpK22YuGN4uBpEVf9V0vV5UdNnA8OxaGxXf10d8ENDkmKa2MzyN5tMu9Si6rOtLI+q62L9V5deoPzMVIxmMJr2Z1lemNuVabvx8tEjayDGsDMRksYIRVVeUjOMLzYgLgLEhWHLDkezWYxSDFLB67d3/LnLMF4IMuAybdMUTSNj2TdYnp9rdb0bm4eH14CoakVFN65ajvNluqMzta+3bxUgBmnfVd/RCRzLhDTbLimG+TvbEn6qb1NtcHcv25n9NChTq+tV2oxKOPjWsdwa2Nvf/9DBocPLAQBSrgfq0RzUvj/9QM3JU9ufvHDxjbUff1obmpw0ai5/ux4QVyy9evUJQKxq2t+/bXemzX2zp0er9zN24+Fh6rnZ0iLQbRuO5EYAEaFj6PCdDdkskIcOmWFRwsa0Pxtx3H9YRSsl+/ZJI9u2wfLvv1u6AHEZIC64D3HJ7YiLH0ZcAoh3YBCVZtmvawkHvFQanLT/im9Zz8QO9HMkL2A04d4UXRcZlkPFMPHtrm62x/fhkWvXHpG6u39kLRub9/fPco47Zx48+NubH114AGhB/I6VlQcpjgdKEEN0NBaiBgdJUpJRUNQSr6jzoqrNBUNENUzM9OyVVv3006OCHS+Fw9HKVyVJGjnHxXB+pBoERbvO8OI7oqoBI8k7WZLaTg4comKSjLwkl2lBnA/aKRgOlCCgbBhXNl7+9qVYW/sfra1hrEs4c1GanY9k95Qap6ZWQ2uU/CtCUsiJ4jpWUbcyFF3PDB6K0bKCgiD+zQniTZJlS8HIIi37WitFPVt15Uo1Z8dvhFvCGKPZeTJKYiyemN89NloNqmmN6na837Dte7WEs8nkhefpoSGF0TSMJlMYMc0gUqQE8XoLy9f0PfYErP75l8fptvZfo/EE7hwcKpFpf57v7r6y6fjxlRBqCAHDC2AlEtCbyy98tbcHdo2MvLg7u6enrv9AakdXl9/c2dmxPZfbGDT7PTMzKwDx7p2nz94fGs2v3frVpdWNhUJ182efrwz691+vyB2aoO5Q1wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Node positions in the crossing textures\"\n        title=\"Node positions in the crossing textures\"\n        src=\"/static/1da157f61d15aed7f18fa04587e9a228/01e7c/crossing_texture.png\"\n        srcset=\"/static/1da157f61d15aed7f18fa04587e9a228/8a4e8/crossing_texture.png 150w,\n/static/1da157f61d15aed7f18fa04587e9a228/5a46d/crossing_texture.png 300w,\n/static/1da157f61d15aed7f18fa04587e9a228/01e7c/crossing_texture.png 512w\"\n        sizes=\"(max-width: 512px) 100vw, 512px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>Let's start by dividing the whole texture into a 3x3 grid. The center of the T crossing is located at the center of tile [2, 3], and the center of the X crossing is located at the center of tile [3, 3]. In texture space, they are located at [3/6, 5/6] and [5/6, 5/6] respectively. However, as we found out in <a href=\"/blog/roads-how-boring-part-4-rendering-straight-roads\">part 4</a>, the engine approximates 1/6 as <code>1.666</code>, truncating all decimal places after the third. This also happens for the center of tile two, which is not <code>0.5</code>, but <code>0.498 (3 * 1.666)</code>.</p>\n<p>We also already know that the default road width of <code>0.25</code> is scaled with the factor <code>RoadWidthInTexture</code>. Now we only need the lengths of the small extruding stubs. By measuring some textures of different sizes, we can find out that it is <code>0.004</code> regardless of <code>RoadWidthInTexture</code>.</p>\n<p>Using the variables</p>\n<table>\n<thead>\n<tr>\n<th>Name</th>\n<th>Abbreviation</th>\n<th>Value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Half tile width</td>\n<td><code>htw</code></td>\n<td><code>0.166</code></td>\n</tr>\n<tr>\n<td>Half road width</td>\n<td><code>hrw</code></td>\n<td><code>0.25 * RoadWidthInTexture / 2</code></td>\n</tr>\n<tr>\n<td>Length to incoming road</td>\n<td><code>lti</code></td>\n<td><code>0.25 / 2 + 0.004</code></td>\n</tr>\n</tbody>\n</table>\n<p>this gives us the following texture coordinates for the T- and X-crossing:</p>\n<table>\n<thead>\n<tr>\n<th>Crossing type</th>\n<th>Left</th>\n<th>Top</th>\n<th>Right</th>\n<th>Bottom</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>T</td>\n<td><code>5 * htw - hrw</code></td>\n<td><code>3 * htw - lti</code></td>\n<td><code>5 * htw + lti</code></td>\n<td><code>3 * htw + lti</code></td>\n</tr>\n<tr>\n<td>X</td>\n<td><code>5 * htw - lti</code></td>\n<td><code>5 * htw - lti</code></td>\n<td><code>5 * htw + lti</code></td>\n<td><code>5 * htw - lti</code></td>\n</tr>\n</tbody>\n</table>\n<p>Unfortunately the two Y crossings are a little less straight forward and require some hardcoded numbers (this time, width and height are given instead of right and bottom coordinates):</p>\n<table>\n<thead>\n<tr>\n<th>Crossing type</th>\n<th>Left</th>\n<th>Top</th>\n<th>Width</th>\n<th>Height</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Symmetric Y</td>\n<td><code>3 * htw - 0.2</code></td>\n<td><code>0.504 - 0.135</code></td>\n<td><code>0.4</code></td>\n<td><code>0.270</code></td>\n</tr>\n<tr>\n<td>Asymmetric Y</td>\n<td><code>0.395 - hrw</code></td>\n<td><code>0.645</code></td>\n<td><code>1.2 * 0.25 + hrw</code></td>\n<td><code>0.335</code></td>\n</tr>\n</tbody>\n</table>\n<p>Using these coordinates, we can now render the crossings, but it doesn't look quite right yet:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5f6440e9de7068e02250fc08ac93fc9f/eb3fa/crossing_overlap.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADLElEQVQozxWSbW/bNgCE9R+GofUar3Ns69WWpaS2ZYkiJVGUSFEUKdty0qYomg5YMWC/qN2GvcRIljQJ0PQHDv52X+5wuOe0/f7TzfXv+/3n/f7z1dWn29s/7u7+fHj45+nr9benm29PN09frx8f9/f3V/f3V4+P+4eH/Zcv//53+9ft3d/azHt+cvpisTxaLvvzRX8VvgzDPgAvg+BouTwKw34MflwuX/j+c8/reV5v5vU8/wf/pOef9LQ0MyEyQDxGyIiiIYjHWWYmqRkCfbE4DlYjEI8gHMdQX0XDIBylmUlyk1G7Ea5WUpsQoyytitkVc6RweeUk2ThJ9TgeRtExQuMEHRJRooN4mOc6oxajVlM7Ws3tpna2rd82rhSTtfJlPRHclmLaiAljVsUsKRzOddnYde0wZlJqFYWFsaFJMZXCrblTlEbF7ZrbFTPK0ua1p5TbSrdVHmUhY4GSi0072ypvs/Za5da1rRWlTUoHJUYExiAexdCcB24AAkxAq15tWkeIEOc5KUrOcSumaznbrmc1dxh3DoMBqAerQbA6DqNhmtkROF2GIUAgySCtFikGmKQ5yZSK33SvtsrfbfymmWLiaAiNYWxEQAexAaFOiM2Yh0kcxCCEIEIwhHGEIClxtw13m5lqpnVlS+HU4mAexbG+Cg9UQjCOwBDEgzQ3CU0hgjhHKU5QhhjHF6/D7drllUXIsJWeaqZaTmyUGifzo2A1jKEOEyOCIwAHnPuMZUkKKMM5SRlLN+1sLSdSehX3RHNgcagdw+M0M7LMJMUkxVZRmrQwONO7LsoJTjEqKcEEtwoKbnFqyXp6ENzUMuySYiKV1zSztvWlcDfS3ShPyel5N29VkaRJTjAheVEQpQBnhuAOo3qGj7WCTBo5axqrrnTB7aY5/KFtJ0JYG+Vt23lRYJQmjJU5ySktGj4XlSm4U1FTU2eye7fr3u52Xakai9Exy0drMavZkpHTjVieKYoRznFWsZIy+vrd5fkF351T2SLt+/7g2WD83dHgJ8c7+/C2uyiKD/Py1wJeluCSgPc5+43j93nVNhc/f+wuf8m7y0yewWq9QOn/BukEQolCz2AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Crossing and road segments overlap\"\n        title=\"Crossing and road segments overlap\"\n        src=\"/static/5f6440e9de7068e02250fc08ac93fc9f/0a47e/crossing_overlap.png\"\n        srcset=\"/static/5f6440e9de7068e02250fc08ac93fc9f/8a4e8/crossing_overlap.png 150w,\n/static/5f6440e9de7068e02250fc08ac93fc9f/5a46d/crossing_overlap.png 300w,\n/static/5f6440e9de7068e02250fc08ac93fc9f/0a47e/crossing_overlap.png 600w,\n/static/5f6440e9de7068e02250fc08ac93fc9f/1cfc2/crossing_overlap.png 900w,\n/static/5f6440e9de7068e02250fc08ac93fc9f/eb3fa/crossing_overlap.png 1026w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>The crossing texture and the straight road segment textures overlap because the segments all start directly at the node position.</p>\n<h2>Connection points</h2>\n<p>We need to move the end points of the incoming road segments outwards to the positions labeled A-M in the image above.</p>\n<p>The following table lists the vectors that need to be added to the node positions to get to these connection points (<code>Up</code>, <code>Down</code>, <code>Left</code>, <code>Right</code>, <code>DownLeft</code> and <code>DownRight</code> being unit vectors pointing in the respective directions and <code>Width</code> and <code>Height</code> referring to the rectangles we calculated in the <a href=\"/blog/roads-how-boring-part-7-rendering-crossings\">last post</a>).</p>\n<table>\n<thead>\n<tr>\n<th>Crossing type</th>\n<th>Position</th>\n<th>Vector from</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Symmetric Y</td>\n<td>A</td>\n<td><code>Up * (0.269 * Height)</code></td>\n</tr>\n<tr>\n<td>Symmetric Y</td>\n<td>B</td>\n<td><code>DownRight * (0.547 * RoadWidth)</code></td>\n</tr>\n<tr>\n<td>Symmetric Y</td>\n<td>C</td>\n<td><code>DownLeft * (0.547 * RoadWidth)</code></td>\n</tr>\n<tr>\n<td>T</td>\n<td>D</td>\n<td><code>Up * (Height / 2)</code></td>\n</tr>\n<tr>\n<td>T</td>\n<td>E</td>\n<td><code>Right * (Width - HalfRoadWidth)</code></td>\n</tr>\n<tr>\n<td>T</td>\n<td>F</td>\n<td><code>Down * (Height / 2)</code></td>\n</tr>\n<tr>\n<td>Asymmetric Y</td>\n<td>G</td>\n<td><code>Up * 0.2 * Height</code></td>\n</tr>\n<tr>\n<td>Asymmetric Y</td>\n<td>H</td>\n<td><code>Down * 0.8 * Height</code></td>\n</tr>\n<tr>\n<td>Asymmetric Y</td>\n<td>I</td>\n<td><code>DownRight * (1.047f * RoadWidth)</code></td>\n</tr>\n<tr>\n<td>X</td>\n<td>J</td>\n<td><code>Left * (Width / 2)</code></td>\n</tr>\n<tr>\n<td>X</td>\n<td>K</td>\n<td><code>Up * (Height / 2)</code></td>\n</tr>\n<tr>\n<td>X</td>\n<td>L</td>\n<td><code>Right * (Width / 2)</code></td>\n</tr>\n<tr>\n<td>X</td>\n<td>M</td>\n<td><code>Down * (Height / 2)</code></td>\n</tr>\n</tbody>\n</table>\n<p>And now, finally, the crossings are done:\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 600px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/146dc252e309f1e32f593bcb05316ade/eb3fa/crossing_no_overlap.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 77.99999999999999%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAA7DAAAOwwHHb6hkAAADJklEQVQozx2M2W7bRgBF+Q8tkCYxYJkiRYqkNkviOpx9OMNFXERJsQPHS9ECfegXtUgeCthx2hSR03xg4QAHF+flHu3jw58Pz/zx+Pj+0+P7z39/+OfTh8///vX09eF4vH96+r7Hh+Px4cuX++Px/r+vH799e3x6enaNEZ1TXWaG4ENC9RQOQDpY+68Xy5fr1Ss/eD1fvPImL2bzn5brl1F0AtNTis8Y0Qk+1Zp6UpQTRGwAzDAahpFOmc24zZhNiB1EwyAYBoEOUoNQSzCrzCd1NdmUXlV4WtdO8tzJuJUrRymH8TGlNkQmwgbCozA8+44ehjrGFqcjwcxcjnPpqMzWMummyCDEFMJm3GLcRtjyg8HKHwThEEITIROkBkQmYabKHalsKW0px1yMNUxHSWpGsRHFQ4hM+vwfCWEhMk6AmSRGFOtBaK5DLwFjwsYADhEyGbelcrV640nlYWJHsRFGRpzoMXDW4fnSXy39WRgZUaSv/PkqCIMoDuPZ2j8NomGKRgibmpSOyJwUmkF4tlydRvEQEyeFoR9Fq8CPwRqTdZQkKQIQwyybE2yBxMTYptTWokRPUpMyF+ExAHYKDSW9tllygUAK4jQJ4yiMn1sJDETm5MUkk45SnsxtDaKRVE5euJRbXLiU25iaCA8Q8QAEmCKAACQogSAvQNPOi3KilMWFWW8WWlHO+u2kLCwlrbaete0sL9wUDWOoExFDAplkLKNc0O02OezmXTetSrcs3G0317p2WuV23037br7fLrrNtCycMh8LYXTb80ziFCVcUkxxWYK6sjel07eLupptm6n29uAfdv7lxWrfzw/7Zd+d9810186bjdt17rYDhEIuCBeIcdI2Sa6sqnCbytuUjrbbTt7sFn3nbSq7Kp269lRutI1Tlmbfzfp2pnKESJopRhnJMr4pF4UyqtyiZKBd3PSHm93+and5kTcbV0pTUL0uvVydK7Fsq9WuYQgAhGKVC5Wry+vrt++qy6tyu6PajyeDF2ejH070U3fe31zVB0FvV9lvWXqXJbc8vRPq9xJdI9mUlz//srv9le3vaP0mLboA4/8BDsn+DA3lVDMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Crossing and road segments don&#39;t overlap anymore\"\n        title=\"Crossing and road segments don&#39;t overlap anymore\"\n        src=\"/static/146dc252e309f1e32f593bcb05316ade/0a47e/crossing_no_overlap.png\"\n        srcset=\"/static/146dc252e309f1e32f593bcb05316ade/8a4e8/crossing_no_overlap.png 150w,\n/static/146dc252e309f1e32f593bcb05316ade/5a46d/crossing_no_overlap.png 300w,\n/static/146dc252e309f1e32f593bcb05316ade/0a47e/crossing_no_overlap.png 600w,\n/static/146dc252e309f1e32f593bcb05316ade/1cfc2/crossing_no_overlap.png 900w,\n/static/146dc252e309f1e32f593bcb05316ade/eb3fa/crossing_no_overlap.png 1026w\"\n        sizes=\"(max-width: 600px) 100vw, 600px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n        decoding=\"async\"\n      />\n  </a>\n    </span></p>\n<p>In the <a href=\"/blog/roads-how-boring-part-9-rendering-curves\">next post</a> we'll tackle the curves.</p>","frontmatter":{"slug":"roads-how-boring-part-8-rendering-crossings-continued","title":"Roads? How boring! Part 8: Rendering crossings (continued)","summary":"Part 8 of the series about rendering the roads in SAGE maps: Rendering crossings (continued)","author":"Daniel Sklenitzka","date":"2020-04-19"}}},"pageContext":{"slug":"roads-how-boring-part-8-rendering-crossings-continued"}},
    "staticQueryHashes": []}